<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>LocalFlow â€” ë‹¹ì²¨ í™•ì¸ & ì¬ê³  & í›„ê¸°</title>
<meta name="theme-color" content="#61D6C2"/>
<meta name="description" content="LocalFlow ë‹¹ì²¨ ì—¬ë¶€ ì¡°íšŒ, ìƒí’ˆ ì¬ê³  í™•ì¸, ë‹¹ì²¨ì í›„ê¸° ëª¨ìŒ"/>

<style>
  :root{
    --bg:#0b0f14; --panel:#111826; --ink:#eaf2ff; --muted:#9fb0c7; --line:#1e2330; --accent:#61d6c2;
    --pill:#0f172a; --thumb:#0c121d;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#0a0f16,#070b11);color:var(--ink);
       font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,sans-serif}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1080px;margin:0 auto;padding:14px}

  header{position:sticky;top:0;background:rgba(7,11,17,.85);backdrop-filter:saturate(150%) blur(6px);
         border-bottom:1px solid var(--line);z-index:10}
  .nav{display:flex;align-items:center;justify-content:space-between;height:64px}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:26px;height:26px;border:1px solid var(--line);border-radius:7px;display:grid;place-items:center;
        background:#0e1522;font-weight:800}
  .pill{display:inline-block;padding:.32rem .65rem;border:1px solid var(--line);border-radius:999px;background:var(--pill);color:var(--muted);font-size:12px}
  .badge{font-size:10px;padding:2px 6px;border:1px solid var(--line);border-radius:999px;background:#0f1624;color:var(--muted)}

  h1{margin:10px 0 8px;font-size:clamp(22px,4vw,28px)}
  h2{margin:18px 0 10px;font-size:clamp(18px,3.4vw,22px)}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px}
  .grid{display:grid;gap:12px}
  .cols-2{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
  .cols-3{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
  .cols-4{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
  .muted{color:var(--muted)}
  .hr{height:1px;background:var(--line);margin:12px 0}
  .btn{appearance:none;border:1px solid var(--line);background:#0f172a;color:var(--ink);padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  input[type="search"],input[type="email"],input[type="text"],select{
    padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#0f172a;color:var(--ink);width:100%
  }

  /* ì„¹ì…˜1: ì‘ëª¨ ì—¬ë¶€ ì¡°íšŒ */
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{border-bottom:1px solid #1a2331;padding:8px 10px;text-align:left}
  .table th{color:#b7c5dd;font-weight:700}
  .status-pill{padding:.25rem .5rem;border:1px solid var(--line);border-radius:999px;background:#0e1624;font-size:12px}
  .ok{color:#22c55e;border-color:#1f3b2b}
  .no{color:#f97316;border-color:#3a2415}
  .win{color:#60a5fa;border-color:#1a2c45}

  /* ì„¹ì…˜2: ìƒí’ˆ ì¹´ë“œ */
  .prize{display:grid;grid-template-rows:120px auto;gap:8px;border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0e1624}
  .prize .thumb{height:120px;background:#0c121d;display:grid;place-items:center}
  .prize .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .prize .meta{padding:8px 10px;display:flex;justify-content:space-between;align-items:center;gap:8px}
  .stock{font-size:12px;color:var(--muted)}
  .stock strong{color:#e5f0ff}

  /* ì„¹ì…˜3: í›„ê¸° ê·¸ë¦¬ë“œ */
  .rev{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0e1624}
  .rev .thumb{aspect-ratio:1/1;background:#0c121d}
  .rev .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .rev .body{padding:8px 10px}
  .rev .meta{display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:12px}

  /* ëª¨ë‹¬ */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
  .modal.show{display:flex}
  .dialog{max-width:900px;width:100%;background:#0f172a;border:1px solid var(--line);border-radius:12px;overflow:hidden}
  .dialog header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--line)}
  .dialog .content{max-height:min(80vh,1000px);overflow:auto}
  .dialog img{width:100%;height:auto;display:block}
</style>
</head>
<body>

<header>
  <div class="wrap nav">
    <div class="brand">
      <div class="logo">LF</div>
      <div>LocalFlow <small class="muted">â€” ë‹¹ì²¨ í™•ì¸</small></div>
      <span class="badge">beta</span>
    </div>
    <a class="pill" href="/" title="ë©”ì¸ìœ¼ë¡œ">â† LocalFlow</a>
  </div>
</header>

<main class="wrap">
  <section class="card">
    <span class="pill">ì£¼ê°„ ìˆœí™˜ í”„ë¡œì íŠ¸</span>
    <h1>ë‚´ê°€ ë‹¹ì²¨ëë‚˜ìš”?</h1>
    <p class="muted" style="margin:0">ì´ í˜ì´ì§€ì—ì„œ <b>ì‘ëª¨ ì—¬ë¶€/ë‹¹ì²¨ ì—¬ë¶€</b>ë¥¼ í™•ì¸í•˜ê³ , <b>ìƒí’ˆ ì¬ê³ </b>ì™€ <b>ë‹¹ì²¨ í›„ê¸°</b>ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </section>

  <!-- 1. ì‘ëª¨ ì—¬ë¶€ ì¡°íšŒ -->
  <section style="margin-top:12px">
    <h2>1) ì‘ëª¨ ì—¬ë¶€ ì¡°íšŒ</h2>
    <div class="card">
      <div class="grid cols-2" style="align-items:end">
        <div>
          <label class="muted">ì´ë©”ì¼ë¡œ ì§ì ‘ í™•ì¸</label>
          <div class="grid" style="grid-template-columns:1fr auto;gap:10px">
            <input id="qEmail" type="email" placeholder="you@example.com" autocomplete="email">
            <button id="btnCheck" class="btn">í™•ì¸</button>
          </div>
          <div id="checkArea" style="margin-top:10px" class="muted">ì´ë©”ì¼ì„ ì…ë ¥í•˜ê³  í™•ì¸ì„ ëˆ„ë¥´ì„¸ìš”.</div>
        </div>
            <div>
          <label class="muted">ì‘ëª¨ì ë¦¬ìŠ¤íŠ¸ ê²€ìƒ‰</label>
          <div class="grid" style="grid-template-columns:1fr auto auto;gap:10px">
            <input id="qSearch" type="search" placeholder="ì´ë©”ì¼/ë‹‰ë„¤ì„/ë©”ëª¨ ê²€ìƒ‰(ë¶€ë¶„ ì¼ì¹˜)">
            <select id="qFilter">
              <option value="">ì „ì²´</option>
              <option value="win">ë‹¹ì²¨ìë§Œ</option>
              <option value="nowin">ë¯¸ë‹¹ì²¨ë§Œ</option>
            </select>
            <button id="btnReload" class="btn">ìƒˆë¡œê³ ì¹¨</button>
          </div>
        </div>

      </div>

      <div class="hr"></div>

      <div style="overflow:auto">
        <table class="table" aria-label="ì‘ëª¨ì ëª©ë¡">
          <thead>
            <tr><th style="min-width:220px">ì´ë©”ì¼</th><th style="min-width:140px">ë‹‰ë„¤ì„</th><th style="min-width:120px">ì‘ëª¨ì¼</th><th style="min-width:120px">ìƒíƒœ</th></tr>
          </thead>
          <tbody id="applTbody"><tr><td colspan="4" class="muted">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- 2. ìƒí’ˆ ì¢…ë¥˜ ë° ì¬ê³  -->
  <section style="margin-top:12px">
    <h2>2) ìƒí’ˆ ì¢…ë¥˜ ë° ì¬ê³ </h2>
    <div id="prizeGrid" class="grid cols-3">
      <!-- JS ë Œë” -->
    </div>
  </section>

  <!-- 3. ë‹¹ì²¨ì í›„ê¸° -->
  <section style="margin-top:12px">
    <h2>3) ë‹¹ì²¨ì í›„ê¸°</h2>
    <div id="revGrid" class="grid cols-4">
      <!-- JS ë Œë” -->
    </div>
    <p class="muted" style="margin-top:6px">
      â€» ì—…ë¡œë“œëŠ” ë‹¹ì²¨ì ê°œë³„ ì´ë©”ì¼ë¡œ ì „ë‹¬ëœ ì „ìš© ì—…ë¡œë“œ URLì—ì„œ ì§„í–‰í•©ë‹ˆë‹¤. (ìŠ¤íŒ¸/ë„ìš© ë°©ì§€)
    </p>
  </section>
</main>

<!-- í›„ê¸° ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
<div id="modal" class="modal" aria-hidden="true" role="dialog" aria-label="í›„ê¸° ì´ë¯¸ì§€ í™•ëŒ€">
  <div class="dialog">
    <header>
      <strong id="mTitle">í›„ê¸° ë¯¸ë¦¬ë³´ê¸°</strong>
      <button id="mClose" class="pill" aria-label="ë‹«ê¸°">ë‹«ê¸°</button>
    </header>
    <div class="content">
      <img id="mImg" src="" alt="í›„ê¸° ì´ë¯¸ì§€">
      <div style="padding:10px;border-top:1px solid var(--line)">
        <div id="mMeta" class="muted" style="font-size:12px"></div>
        <div id="mText" style="margin-top:6px"></div>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== API Endpoints (ë™ì¼ ì˜¤ë¦¬ì§„ ê¶Œì¥) =====
   ì‘ëª¨ì/ë‹¹ì²¨ ì¡°íšŒ     GET  /event/applicants.json
                       -> [{email,nick,date,win(boolean)}]
   ë‹¨ê±´ í™•ì¸           GET  /event/check?email=...
                       -> {exists:true|false, win:true|false, round:"2025-W45", prize:"ì¹˜í‚¨ ì¿ í°"?}
   ìƒí’ˆ/ì¬ê³            GET  /data/prizes.json
                       -> {round:"...", items:[{id,name,stock,img}]}
   í›„ê¸° ë¦¬ìŠ¤íŠ¸         GET  /data/reviews.json
                       -> [{id,img,thumb?,title,text,by,date}]  (thumb ì—†ìœ¼ë©´ img ì‚¬ìš©)
*/
const API = {
  applicants: "https://mrdindoin.ddns.net/data/applicants.json",
  check:      "https://mrdindoin.ddns.net/event/check",
  prizes:     "https://mrdindoin.ddns.net/data/prizes.json",
  reviews:    "https://mrdindoin.ddns.net/data/reviews.json"
};

const $ = s=>document.querySelector(s);

/* ---------- 1) ì‘ëª¨ ì—¬ë¶€ ì¡°íšŒ ---------- */
const qEmail = $("#qEmail");
const btnCheck = $("#btnCheck");
const checkArea = $("#checkArea");

const qSearch = $("#qSearch");
const qFilter = $("#qFilter");
const btnReload = $("#btnReload");
const applTbody = $("#applTbody");

let APPLICANTS = [];

btnCheck.onclick = async ()=>{
  const v=(qEmail.value||"").trim();
  if(!v){ alert("ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”."); return; }
  try{
    const r = await fetch(`${API.check}?email=${encodeURIComponent(v)}`, {cache:"no-store"});
    const j = await r.json();
    if(!j.exists){
      checkArea.innerHTML = `âŒ <span class="status-pill no">ì‘ëª¨ ê¸°ë¡ ì—†ìŒ</span>`;
    }else if(j.win){
      checkArea.innerHTML = `âœ… <span class="status-pill win">ë‹¹ì²¨</span> â€” íšŒì°¨ <b>${j.round||"-"}</b> / ìƒí’ˆ <b>${j.prize||"-"}</b>`;
    }else{
      checkArea.innerHTML = `ğŸ“ <span class="status-pill ok">ì‘ëª¨ë¨</span> â€” íšŒì°¨ <b>${j.round||"-"}</b>`;
    }
  }catch(e){
    checkArea.textContent = "ì„œë²„ í†µì‹  ì˜¤ë¥˜. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.";
  }
};

btnReload.onclick = loadApplicants;
qSearch.addEventListener("input", debounce(renderApplicants, 180));
qFilter.addEventListener("change", renderApplicants);

async function loadApplicants(){
  applTbody.innerHTML = `<tr><td colspan="4" class="muted">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr>`;
  try{
    const r = await fetch(API.applicants, {cache:"no-store"});
    APPLICANTS = r.ok ? await r.json() : [];
  }catch(e){ APPLICANTS = []; }
  renderApplicants();
}
function renderApplicants(){
  const q=(qSearch.value||"").trim().toLowerCase();
  const f=qFilter.value;
  const rows = APPLICANTS.filter(a=>{
    const okF = f==="" || (f==="win" && a.win) || (f==="nowin" && !a.win);
    if(!okF) return false;
    if(!q) return true;
    return (a.email||"").toLowerCase().includes(q) ||
           (a.nick||"").toLowerCase().includes(q) ||
           (a.memo||"").toLowerCase().includes(q);
  }).map(a=>{
    const st = a.win ? `<span class="status-pill win">ë‹¹ì²¨</span>`
                     : `<span class="status-pill ok">ì‘ëª¨</span>`;
    return `<tr>
      <td>${escapeHtml(a.email||"")}</td>
      <td>${escapeHtml(a.nick||"-")}</td>
      <td>${escapeHtml(a.date||"-")}</td>
      <td>${st}</td>
    </tr>`;
  }).join("");
  applTbody.innerHTML = rows || `<tr><td colspan="4" class="muted">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
}

/* ---------- 2) ìƒí’ˆ ì¢…ë¥˜ ë° ì¬ê³  ---------- */
const prizeGrid = $("#prizeGrid");
async function loadPrizes(){
  prizeGrid.innerHTML = "";
  try{
    const r = await fetch(API.prizes, {cache:"no-store"});
    const j = r.ok ? await r.json() : {items:[]};
    (j.items||[]).forEach(p=>{
      const img = p.img ? `<img src="${encodeURI(p.img)}" loading="lazy" alt="${escapeHtml(p.name)}">`
                        : `<span class="muted">No Image</span>`;
      prizeGrid.insertAdjacentHTML("beforeend", `
        <article class="prize">
          <div class="thumb">${img}</div>
          <div class="meta">
            <div><strong>${escapeHtml(p.name)}</strong><div class="stock">ì¬ê³  <strong>${p.stock??"-"}</strong></div></div>
            ${p.brand?`<span class="pill">${escapeHtml(p.brand)}</span>`:""}
          </div>
        </article>
      `);
    });
  }catch(e){
    prizeGrid.innerHTML = `<div class="card muted">ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>`;
  }
}

/* ---------- 3) ë‹¹ì²¨ì í›„ê¸° ---------- */
const revGrid = $("#revGrid");
const modal = $("#modal"), mImg=$("#mImg"), mTitle=$("#mTitle"), mText=$("#mText"), mMeta=$("#mMeta");
$("#mClose").onclick = ()=> modal.classList.remove("show");
modal.addEventListener("click", e=>{ if(e.target===modal) modal.classList.remove("show"); });

async function loadReviews(){
  revGrid.innerHTML = "";
  try{
    const r = await fetch(API.reviews, {cache:"no-store"});
    const arr = r.ok ? await r.json() : [];
    if(!arr.length){
      revGrid.innerHTML = `<div class="card muted">ì•„ì§ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
      return;
    }
    arr.forEach(v=>{
      const t = v.thumb || v.img;
      revGrid.insertAdjacentHTML("beforeend", `
        <article class="rev">
          <div class="thumb">
            <img src="${encodeURI(t)}" loading="lazy" alt="${escapeHtml(v.title||'í›„ê¸° ì´ë¯¸ì§€')}"
                 onclick="openReview('${encodeURIComponent(v.img)}','${escapeHtmlJS(v.title||"í›„ê¸°")}','${escapeHtmlJS(v.by||"-")}','${escapeHtmlJS(v.date||"")}','${escapeHtmlJS(v.text||"")}')">
          </div>
          <div class="body">
            <div class="meta"><span>${escapeHtml(v.title||"í›„ê¸°")}</span><span>${escapeHtml(v.date||"")}</span></div>
            <div class="muted" style="font-size:12px">${escapeHtml(v.by||"")}</div>
          </div>
        </article>
      `);
    });
  }catch(e){
    revGrid.innerHTML = `<div class="card muted">í›„ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>`;
  }
}

window.openReview = (imgUrlEnc, title, by, date, text)=>{
  mImg.src = decodeURIComponent(imgUrlEnc);
  mTitle.textContent = title;
  mMeta.textContent = `${by||""} ${date?(" Â· "+date):""}`;
  mText.textContent = text||"";
  modal.classList.add("show");
};

/* ---------- utils ---------- */
function escapeHtml(s){ return (s||"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m])); }
function escapeHtmlJS(s){ return escapeHtml(s).replace(/\n/g," "); }
function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }

/* ---------- init ---------- */
loadApplicants();
loadPrizes();
loadReviews();
</script>

</body>
</html>
