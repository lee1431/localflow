<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>ì¶”ì–µì˜ ë½‘ê¸°íŒ (ì›¹)</title>
<style>
  :root{
    --cell-size: clamp(28px, 8.5vw, 56px);
    --gap: 6px;
    --radius: 10px;
    --primary: #2b8aef;
    --ink: #14213d;
    --line: #e9edf3;
    --yellow: #ffd34d;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, 'Apple SD Gothic Neo', sans-serif; color:var(--ink); background:#fbfcff}
  header{position:sticky; top:0; z-index:2; background:#fff; border-bottom:1px solid var(--line)}
  .wrap{max-width:960px; margin:0 auto; padding:14px 16px}
  h1{margin:0; font-size:clamp(18px,3.8vw,22px)}
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:8px}
  input[type="email"]{flex:1; min-width:220px; padding:10px 12px; border:1px solid var(--line); border-radius:10px}
  .btn{padding:10px 14px; border:0; border-radius:10px; background:var(--primary); color:#fff; cursor:pointer}
  .btn[disabled]{opacity:.5; cursor:not-allowed}
  .hint{font-size:12px; color:#667085}
  main{padding:18px 16px}
  .board{
    display:grid;
    grid-template-columns: repeat(10, var(--cell-size));
    gap:var(--gap);
    justify-content:center;
    user-select:none;
    perspective: 900px;
    margin: 0 auto;
  }
  .cell{
    width:var(--cell-size); height:var(--cell-size);
    position:relative;
    transform-style:preserve-3d;
    transition: transform .6s cubic-bezier(.2,.8,.2,1);
    border-radius:var(--radius);
    box-shadow: 0 4px 12px rgba(0,0,0,.06);
    cursor:pointer;
  }
  .cell.is-open{ transform: rotateY(180deg); cursor:default; }
  .face{
    position:absolute; inset:0;
    display:flex; align-items:center; justify-content:center;
    border-radius:var(--radius);
    border:1px solid var(--line);
    backface-visibility:hidden;
    font-weight:700;
  }
  .front{
    background:linear-gradient(135deg,#0b5ed7,#113a8a);
    color:#fff;
  }
  .front .star{
    width:60%; height:60%;
    border-radius:6px;
    display:grid; place-items:center;
    background:repeating-linear-gradient(45deg, rgba(255,255,255,.15) 0 8px, rgba(255,255,255,.05) 8px 16px);
    border:2px solid rgba(255,255,255,.3);
  }
  .front .star::after{
    content:"â˜…"; color:var(--yellow); font-size:clamp(16px,5vw,22px);
    text-shadow:0 2px 0 rgba(0,0,0,.25);
  }
  .back{
    transform: rotateY(180deg);
    background:#fff;
    font-size:clamp(12px,3.4vw,16px);
  }
  .pill{display:inline-flex; align-items:center; gap:6px; padding:.35rem .6rem; background:#fff; border:1px solid var(--line); border-radius:999px}
  .legend{display:flex; flex-wrap:wrap; gap:8px; margin:14px auto; justify-content:center}
  .toast{
    position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
    background:#111; color:#fff; padding:10px 14px; border-radius:10px; opacity:0; pointer-events:none;
    transition:opacity .25s, transform .25s;
  }
  .toast.show{ opacity:1; transform:translateX(-50%) translateY(-6px); }
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>ì¶”ì–µì˜ ë½‘ê¸°íŒ</h1>
      <div class="row">
        <input id="email" type="email" placeholder="ì—°ë½ìš© ì´ë©”ì¼ (ì„ íƒ)" />
        <button id="resetBtn" class="btn" title="URLì— #adminì´ ìˆì„ ë•Œë§Œ í™œì„±í™”" disabled>ìƒˆ íŒ ë§Œë“¤ê¸°</button>
      </div>
      <div class="row hint">
        ì˜¤ëŠ˜ì€ ë¸Œë¼ìš°ì €ë‹¹ 1íšŒë§Œ ë½‘ì„ ìˆ˜ ìˆì–´ìš”. (ì˜¤í”„ë¼ì¸ ë°ëª¨ìš©)
      </div>
    </div>
  </header>

  <main>
    <div class="legend" id="legend"></div>
    <div id="board" class="board" aria-label="ë½‘ê¸°íŒ"></div>
  </main>

  <div id="toast" class="toast"></div>

<script>
/* =======================
   ì„¤ì • (ìˆ˜ëŸ‰ë§Œ ë°”ê¿”ì„œ ì“°ì„¸ìš”)
   ì´í•©ì´ ë³´ë“œ ì¹¸ ìˆ˜(100)ì™€ ê°™ì•„ì•¼ í•¨
======================= */
const PRIZE_COUNTS = {
  "ì¹˜í‚¨": 1,
  "ì»¤í”¼": 10,
  "ì‚¬íƒ•": 20,
  "ê½": 69
};
// í‘œì‹œìš© ì´ëª¨ì§€(ì›í•˜ë©´ ìˆ˜ì •)
const PRIZE_EMOJI = {
  "ì¹˜í‚¨":"ğŸ—", "ì»¤í”¼":"â˜•ï¸", "ì‚¬íƒ•":"ğŸ¬", "ê½":"ğŸ™ˆ"
};

// ===== ìœ í‹¸ =====
const todayKey = () => new Date().toISOString().slice(0,10); // YYYY-MM-DD
const LS_PICK_KEY = 'lottery_pick_' + todayKey();
const LS_BOARD_KEY = 'lottery_board_' + todayKey(); // ì˜¤ëŠ˜ ë³´ë“œ(seed)

function toast(msg){
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toast._t);
  toast._t = setTimeout(()=>t.classList.remove('show'), 1800);
}

// ì•”í˜¸í•™ì  ì„ê¸° (ê°€ëŠ¥í•˜ë©´ crypto ì‚¬ìš©)
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const r = (window.crypto && crypto.getRandomValues)
      ? crypto.getRandomValues(new Uint32Array(1))[0] % (i+1)
      : Math.floor(Math.random()*(i+1));
    [arr[i], arr[r]] = [arr[r], arr[i]];
  }
  return arr;
}

// ë³´ë“œ ë°ì´í„° ë§Œë“¤ê¸°(100ì¹¸)
function buildBoardData(){
  const totalCells = 100;
  const pool = [];
  let sum = 0;
  for(const [k,v] of Object.entries(PRIZE_COUNTS)){ sum += v; for(let i=0;i<v;i++) pool.push(k); }
  if(sum !== totalCells) {
    alert(`PRIZE_COUNTS ì´í•©ì´ ${totalCells}ì´ ì•„ë‹™ë‹ˆë‹¤. í˜„ì¬ ${sum}`);
  }
  shuffle(pool);
  return pool; // ê¸¸ì´ 100, ê° ì¹¸ì˜ ë³´ìƒ ë¬¸ìì—´
}

// ì €ì¥ëœ ë³´ë“œ ë¶ˆëŸ¬ì˜¤ê¸°(ì—†ìœ¼ë©´ ìƒì„±)
function getBoardData(){
  const saved = localStorage.getItem(LS_BOARD_KEY);
  if(saved){ try{ return JSON.parse(saved); }catch{} }
  const board = buildBoardData();
  localStorage.setItem(LS_BOARD_KEY, JSON.stringify(board));
  return board;
}

// ì „ì„¤(ìˆ˜ëŸ‰í‘œ) í‘œì‹œ â€” ê³µê°œê°€ ì‹«ìœ¼ë©´ ì´ ë¸”ë¡ì„ ì£¼ì„ ì²˜ë¦¬
function renderLegend(){
  const legend = document.getElementById('legend');
  legend.innerHTML = Object.entries(PRIZE_COUNTS).map(([k,v]) =>
    `<span class="pill">${PRIZE_EMOJI[k]||""}<b>${k}</b> Ã— ${v}</span>`
  ).join('');
}

// ë³´ë“œ ë Œë”
function renderBoard(){
  const board = document.getElementById('board');
  const data = getBoardData();
  board.innerHTML = "";
  data.forEach((prize, idx)=>{
    const el = document.createElement('div');
    el.className = 'cell';
    el.setAttribute('data-prize', prize);
    el.innerHTML = `
      <div class="face front" aria-hidden="false">
        <div class="star"></div>
      </div>
      <div class="face back" aria-hidden="true">${PRIZE_EMOJI[prize]||""}&nbsp;${prize}</div>
    `;
    el.addEventListener('click', ()=> onPick(el, idx));
    board.appendChild(el);
  });
}

// í´ë¦­ ì²˜ë¦¬ (í•˜ë£¨ 1íšŒ ì œí•œ)
function onPick(cell, idx){
  if(localStorage.getItem(LS_PICK_KEY)){
    toast('ì˜¤ëŠ˜ì€ ì´ë¯¸ ì°¸ì—¬í•˜ì…¨ì–´ìš”!');
    return;
  }
  if(cell.classList.contains('is-open')) return;

  cell.classList.add('is-open');
  const prize = cell.getAttribute('data-prize');
  const email = (document.getElementById('email').value||"").trim();

  // ì €ì¥ (ìš´ì˜ ì „í™˜ ì‹œ ì„œë²„ë¡œ ì „ì†¡í•˜ì„¸ìš”)
  const result = { date: todayKey(), prize, index: idx, email };
  localStorage.setItem(LS_PICK_KEY, JSON.stringify(result));

  // ì—°ì¶œ
  toast(`ê²°ê³¼: ${prize}${PRIZE_EMOJI[prize]?" "+PRIZE_EMOJI[prize]:""}`);
  navigator.vibrate && navigator.vibrate(60); // ëª¨ë°”ì¼ ì§„ë™(ì§€ì› ê¸°ê¸°)
}

// ê´€ë¦¬ì: ìƒˆ íŒ ë§Œë“¤ê¸° (URLì— #admin ìˆì„ ë•Œë§Œ í™œì„±í™”)
function setupAdmin(){
  const btn = document.getElementById('resetBtn');
  const isAdmin = location.hash.includes('admin');
  if(!isAdmin){ btn.disabled = true; return; }
  btn.disabled = false;
  btn.addEventListener('click', ()=>{
    if(!confirm('ì˜¤ëŠ˜ ë³´ë“œë¥¼ ìƒˆë¡œ ì„ì„ê¹Œìš”? (ì´ë¯¸ ë½‘ì€ ì‚¬ìš©ì ê¸°ë¡ì€ ìœ ì§€ë©ë‹ˆë‹¤)')) return;
    localStorage.removeItem(LS_BOARD_KEY);
    renderBoard();
    toast('ìƒˆ ë³´ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
  });
}

// ì´ˆê¸°í™”
renderLegend();
renderBoard();
setupAdmin();
</script>
</body>
</html>