<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="google-adsense-account" content="ca-pub-9382191250873184">
  <title>LocalFlow â€” Circulation for ì¶©ì£¼</title>

  <!-- SEO -->
  <meta name="description" content="LocalFlowëŠ” â€˜ë­ ë¨¹ê³  ì‹¶ë‹ˆ?â€™ë¼ëŠ” í•œë§ˆë””ë¡œ ì§€ì—­ì˜ ì‹ìš• ë°ì´í„°ë¥¼ ëª¨ì•„ ì£¼ê°„ ìˆœí™˜ ì†Œë¹„ë¥¼ ì‹¤í–‰í•˜ëŠ” ì‹œë¯¼ ì°¸ì—¬í˜• í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. LocalFlow by Stance." />
  <meta name="keywords" content="LocalFlow, ë¡œì»¬í”Œë¡œìš°, ë¡œì»¬, ì§€ì—­, ìˆœí™˜ê²½ì œ, ì¶©ì£¼, ì‹œë¯¼ì°¸ì—¬, ë¨¹ê³ ì‹¶ë‹ˆ" />
  <meta name="theme-color" content="#61D6C2" />
  <link rel="canonical" href="https://localflow.info/" />

  <!-- Open Graph -->
  <meta property="og:title" content="LocalFlow â€” Circulation for ì¶©ì£¼" />
  <meta property="og:description" content="â€˜ë­ ë¨¹ê³  ì‹¶ë‹ˆ?â€™ í•œë§ˆë””ê°€ ì§€ì—­ì„ ì›€ì§ì…ë‹ˆë‹¤. LocalFlow by Stance." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://localflow.info/" />
  <meta property="og:image" content="https://localflow.info/og-cover.png" />

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%2361D6C2'/%3E%3Cpath d='M18 36c8 10 20 10 28 0' fill='none' stroke='%23fff' stroke-width='6' stroke-linecap='round'/%3E%3Cpath d='M14 26c4 6 10 9 18 9s14-3 18-9' fill='none' stroke='%23fff' stroke-width='6' stroke-linecap='round'/%3E%3C/svg%3E" />

  <!-- AdSense (ì›í•˜ì‹¤ ë•Œ ìœ ì§€) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9382191250873184" crossorigin="anonymous"></script>

  <!-- StyleSheet -->
  <link rel="stylesheet" href="./css/style.css" />
  
</head>
  
<body>
  <!-- Header -->
  <header>
  <div class="wrap">
    <div class="nav" style="display:flex;align-items:center;justify-content:space-between;height:64px;">
      <div class="brand">
        <span class="logo"></span>
        <div>LocalFlow <small>by Stance</small></div>
      </div>
      <button id="menuBtn" aria-label="ë©”ë‰´ ì—´ê¸°" class="hamb" style="margin-left:12px">
        <span></span>
      </button>
    </div>

    <!-- ë“œë¡­ë‹¤ìš´ ë©”ë‰´ -->
    <nav id="mobileMenu" class="mobile-nav" aria-label="Mobile Navigation">
      <a href="#concept">ê°œë…</a>
      <a href="#loop">ì‘ë™ë°©ì‹</a>
      <a href="#notices">ë‰´ìŠ¤</a>
      <a href="#roadmap">ë¡œë“œë§µ</a>
    </nav>
  </div>
</header>
  <div id="overlay" class="overlay" aria-hidden="true"></div>  
  <!-- Hero -->
  <section class="hero" aria-labelledby="hero-title">
    <div class="wrap">
      <span class="pill">ì‹œë¯¼ ì°¸ì—¬í˜• ë¡œì»¬ ìˆœí™˜ í”„ë¡œì íŠ¸</span>
      <h1 id="hero-title">ë­ ë¨¹ê³  ì‹¶ë‹ˆ? <br/>ê·¸ í•œë§ˆë””ê°€ ì§€ì—­ì„ ì›€ì§ì…ë‹ˆë‹¤.</h1>
      <p>LocalFlowëŠ” â€˜ë¨¹ê³  ì‹¶ì€ ê²ƒâ€™ì„ ë°ì´í„°ë¡œ ëª¨ì•„ ì£¼ê°„ ë­í‚¹ì„ ë§Œë“¤ê³ , ì‹¤ì œ ì†Œë¹„ë¡œ ì—°ê²°í•©ë‹ˆë‹¤.</p>

      <input id="emailInput" type="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”"
           style="padding:12px 14px;border:1px solid #ccc;border-radius:10px;width:250px;font-size:15px;">
      <button id="emailSubmit"
              style="background:#61D6C2;border:none;border-radius:10px;padding:12px 16px;font-weight:600;cursor:pointer;">
        í™•ì¸
      </button>
      <div id="emailDisplay" style="margin-top:10px;display:none;">
        <button id="emailBtn" style="background:#fff;border:1px solid #ccc;border-radius:999px;padding:8px 14px;cursor:pointer;">
        </button>
      </div>
      <form class="ask" onsubmit="return addWord(event)" aria-label="ë¨¹ê³  ì‹¶ì€ ìŒì‹ ì…ë ¥">
        <input class="input" id="foodInput" name="food" maxlength="24" autocomplete="off" placeholder="ì˜ˆ: ì¹˜í‚¨, ë¼ë©˜, ê³±ì°½, íƒ•ìˆ˜ìœ¡â€¦" aria-label="ë¨¹ê³  ì‹¶ì€ ìŒì‹" />
        <button class="btn" type="submit">ë³´ë‚´ê¸°</button>
        <a class="chip" href="#loop" aria-label="ì‘ë™ ë°©ì‹ ìì„¸íˆ">ë„ì›€ë§</a>
      </form>

      <div class="cloud" id="cloud" aria-hidden="true"></div>
      <noscript><p class="muted" style="margin-top:10px">ë¸Œë¼ìš°ì €ì—ì„œ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ êº¼ì ¸ ìˆìŠµë‹ˆë‹¤. ë‹¨ì–´ êµ¬ë¦„ ì• ë‹ˆë©”ì´ì…˜ì€ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p></noscript>
    </div>
  </section>

  <section id="weeklyTop" class="my-10 text-center">
    <h3 class="text-xl font-bold mb-4">ì´ë²ˆì£¼ í‚¤ì›Œë“œ ğŸ¥‡</h3>
    <div id="keywordList" class="flex justify-center gap-6 text-lg"></div>
  </section>

  <!-- Concept -->
  <section id="concept">
    <div class="wrap">
      <h2>LocalFlow â€” ê°œë…</h2>
      <div class="grid cols-3">
        <div class="card">
          <h3>ì°¸ì—¬ì˜ ë‹¨ìˆœí™”</h3>
          <p>ë¡œê·¸ì¸ ì—†ì´, í•œ ë²ˆì˜ ì…ë ¥. ì´ˆì €í•­ ì¸í„°í˜ì´ìŠ¤ë¡œ ëˆ„êµ¬ë‚˜ ì°¸ì—¬.</p>
        </div>
        <div class="card">
          <h3>ì†Œë¹„ì˜ ìˆœí™˜í™”</h3>
          <p>ì£¼ê°„ ë­í‚¹ 1ë“± ë©”ë‰´ë¥¼ ë§¤ì£¼ <strong>ëª©ìš”ì¼</strong> ì„ ì •í•©ë‹ˆë‹¤.</p>
        </div>
        <div class="card">
          <h3>ìš•êµ¬ì˜ ì‹œê°í™”</h3>
          <p>ì „ë‹¬ëœ ë‚´ìš©ì€ í•„í„°ë§ í›„ ë…¸ì¶œë©ë‹ˆë‹¤. AI í•„í„°ë§ìœ¼ë¡œ <strong>24ì‹œê°„ ì´í›„ í™•ì¸</strong> ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Loop -->
  <section id="loop">
    <div class="wrap">
      <h2>ì£¼ê°„ ë£¨í”„ â€” ì–´ë–»ê²Œ ì‘ë™í•˜ë‚˜ìš”?</h2>
      <div class="grid cols-4" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:14px;">
        <div class="card"><span class="pill">â‘  ì°¸ì—¬</span><h3>ì…ë ¥</h3><p>â€œë­ ë¨¹ê³  ì‹¶ë‹ˆ?â€ì— ë‹µí•˜ë©´ ë°ì´í„°ë¡œ ì €ì¥ë©ë‹ˆë‹¤.</p></div>
        <div class="card"><span class="pill">â‘¡ ì§‘ê³„</span><h3>ë­í‚¹</h3><p>ì¼ì£¼ì¼ ë‹¨ìœ„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ìƒìœ„ ë©”ë‰´ë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.</p></div>
        <div class="card"><span class="pill">â‘¢ ì‹¤í–‰</span><h3>êµ¬ë§¤</h3><p>ë§¤ì£¼ ì •í•´ì§„ ê¸ˆì•¡ë§Œí¼ì˜ ì¸ì›ì„ ì¶”ì²¨, ì§€ì—­ìƒí’ˆê¶Œ ì¦ì •.</p></div>
        <div class="card"><span class="pill">â‘£ ê³µê°œ</span><h3>ê³µìœ </h3><p>ì›¹/ì¹´ë“œë‰´ìŠ¤ë¡œ ê²°ê³¼ë¥¼ ë°œí‘œí•˜ê³  ë‹¤ìŒ ì£¼ë¡œ ì´ì–´ê°‘ë‹ˆë‹¤.</p></div>
      </div>
    </div>
  </section>

<!-- Notices -->
<section id="notices">
  <div class="wrap">
    <h2>ê³µì§€</h2>
    <div id="noticeSkeleton" class="grid cols-2" aria-hidden="true">
      <div class="card"><div class="muted">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div></div>
      <div class="card"><div class="muted">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div></div>
    </div>
    <div id="noticeFeed" class="grid cols-2"></div>
    <div style="margin-top:12px">
      <button id="noticeMore" class="btn" style="display:none">ë”ë³´ê¸°</button>
    </div>
  </div>
</section>


  <!-- Roadmap -->
  <section id="roadmap">
    <div class="wrap">
      <h2>ë¡œë“œë§µ</h2>
      <div class="grid cols-3">
        <div class="card"><h3>Phase 1 â€” 2025.11</h3><p>MVP ë¡ ì¹­: ì…ë ¥/ë­í‚¹/ê²°ê³¼ ê³µê°œ. ë„ë©”ì¸ ì—°ê²°.</p></div>
        <div class="card"><h3>Phase 2 â€” 2025.12</h3><p>ê´€ë¦¬ì ì¶”ì²¨/í†µê³„ ì¹´ë“œë‰´ìŠ¤ ìë™í™”. ë„ì‹œë³„ ì„œë¸Œë„ë©”ì¸.</p></div>
        <div class="card"><h3>Phase 3 â€” 2026.01~</h3><p>ë¡œì»¬ ê°€ë§¹ ì—°ê³„ ì¿ í°, ë°ì´í„° ë¦¬í¬íŠ¸, DAO ì‹¤í—˜.</p></div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="wrap footline">
      <div class="muted">Â© 2025 Stance â€” LocalFlow Project .feat GPT</div>
      <div class="muted">LocalFlowëŠ” ì‹œë¯¼ ì°¸ì—¬í˜• ë¡œì»¬ ìˆœí™˜ ì‹¤í—˜ì…ë‹ˆë‹¤.</div>
    </div>
  </footer>

  <button id="toTop" class="to-top" aria-label="ë§¨ ìœ„ë¡œ">â†‘</button>

  <!-- Notice Modal -->
  <div id="noticeModal" class="notice-modal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog" role="dialog" aria-modal="true">
      <button class="modal-close" aria-label="ë‹«ê¸°">Ã—</button>
      <img id="modalImg" class="modal-img" src="" alt="" />
      <div class="modal-meta" id="modalDate"></div>
      <h3 class="modal-title" id="modalTitle"></h3>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <div id="toast" style="position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
  background:#111;color:#fff;padding:10px 14px;border-radius:999px;font-size:.9rem;
  box-shadow:0 10px 24px rgba(0,0,0,.2);opacity:0;pointer-events:none;transition:opacity .2s;
  z-index:90">ìƒˆ ê³µì§€ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤</div>





  

 <script>  
const btn = document.getElementById('menuBtn');
const mobileMenu = document.getElementById('mobileMenu');
const ovl  = document.getElementById('overlay');

function openMenu(open) {
  if (open) {
    mobileMenu.classList.add('show');
    ovl.classList.add('show');
    btn.setAttribute('aria-expanded', 'true');
    document.body.style.overflow = 'hidden';
  } else {
    mobileMenu.classList.remove('show');
    ovl.classList.remove('show');
    btn.setAttribute('aria-expanded', 'false');
    document.body.style.overflow = '';
  }
}

btn.addEventListener('click', () => {
  const willOpen = !mobileMenu.classList.contains('show');
  openMenu(willOpen);
});
ovl.addEventListener('click', () => openMenu(false));

// --- Floating words + data hybrid ---
const cloud = document.getElementById('cloud');
const input = document.getElementById('foodInput');
let cloudWidth = cloud.clientWidth;

const DATA_URL = "https://mrdindoin.ddns.net/data/latest-counts.json";

function todayKey(){ return new Date().toISOString().slice(0,10); }

function makeSizeScaler(items){
  const counts = items.map(i => Number(i.count) || 1);
  const min = Math.min(...counts);
  const max = Math.max(...counts);
  const span = max - min;

  const rankMap = new Map(items.map((it, i) => [it.food, i + 1]));
  const N = items.length || 1;

  return (count, food) => {
    if (span >= 1) {
      const t = (count - min) / span;
      return 14 + t * (28 - 14);
    } else {
      const r = rankMap.get(food) || N;
      const rt = (N - r) / Math.max(1, N - 1);
      const jitter = 0.9 + Math.random()*0.2;
      return (16 + rt * (30 - 16)) * jitter;
    }
  };
}

function mapCountsToItems(json){
  const arr = Array.isArray(json?.top) ? json.top : [];
  return arr.map((it,i)=>({
    food: String(it.food||'').trim(),
    count: Number(it.count)||1,
    rank: i+1
  }));
}
async function fetchWithTimeout(url, ms=4000, opts={}){
  const c = new AbortController();
  const id = setTimeout(()=>c.abort(), ms);
  try { return await fetch(url, { ...opts, signal:c.signal }); }
  finally { clearTimeout(id); }
}

   
function spawn(arg1, arg2){
  let item = (typeof arg1 === 'object') ? arg1 : { food: String(arg1), count: 1, rank: 99 };
  const scale = (typeof arg2 === 'function') ? arg2 : null;

  const el = document.createElement('div');
  el.className = 'word';
  el.textContent = item.food;
  el.title = `${item.food} â€¢ ${item.count}`;

  const baseFs = 14 + Math.random()*14;
  const baseDur = 9 + Math.random()*8;

  const fs = scale ? scale(item.count, item.food) : baseFs;
  const dur = scale ? (9 + (28 - fs) * 0.4) : baseDur;

  const x = Math.max(8, Math.random()*(cloudWidth-80));
  const dx = (Math.random()*40 - 20) + "px";
  el.style.left = x+'px';
  el.style.bottom = '-20px';
  el.style.fontSize = fs+'px';
  el.style.animationDuration = dur+'s';
  el.style.setProperty('--dx', dx);
  if(item.rank === 1) el.style.fontWeight = '800';

  cloud.appendChild(el);
  setTimeout(()=> el.remove(), dur*1000);
}

async function loadWords(){
  const fallback = ["ì¹˜í‚¨ğŸ—","ë¼ë©˜ğŸœ","ê³±ì°½ğŸ”¥","ì§œì¥ë©´","ë¹„ë¹”ë°¥","í”¼ìğŸ•","íƒ•ìˆ˜ìœ¡ğŸ¥¢","ë§‰êµ­ìˆ˜","ì‚¼ê²¹ì‚´ğŸ·","ì—°ì–´"]
    .map((n,i)=>({food:n,count:1,rank:i+1}));

  const url = DATA_URL + `?t=${Date.now()}`; // ì¤‘ê°„ ìºì‹œ íšŒí”¼
  try{
    let res = await fetchWithTimeout(url, 4000, { cache:'no-store' });
    if(!res.ok) throw new Error(res.status);
    let data = await res.json();
    let items = mapCountsToItems(data);
    if(items.length) return items;

    // ë°ì´í„°ê°€ ë¹„ì–´ìˆìœ¼ë©´ í•œ ë²ˆë§Œ ì¬ì‹œë„
    res = await fetchWithTimeout(url, 4000, { cache:'no-store' });
    if(!res.ok) throw new Error(res.status);
    data = await res.json();
    items = mapCountsToItems(data);
    return items.length ? items : fallback;
  }catch{
    return fallback;
  }
}

let WORDS=null, sizeScale=null;
async function initWords(){ WORDS = await loadWords(); sizeScale = makeSizeScaler(WORDS); }

async function seedLoop(){
  if(!WORDS) await initWords();
  const pick = WORDS[Math.floor(Math.random()*WORDS.length)];
  spawn(pick, sizeScale);
  setTimeout(seedLoop, 600 + Math.random()*900);
}
seedLoop();

// --- Email Handling ---
  let userEmail = null;
  const emailInput = document.getElementById('emailInput');
  const emailSubmit = document.getElementById('emailSubmit');
  const emailDisplay = document.getElementById('emailDisplay');
  const emailBtn = document.getElementById('emailBtn');
  
  emailSubmit.addEventListener('click', () => {
    const val = emailInput.value.trim();
    if (!val || !val.includes('@')) {
      alert('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.');
      return;
    }
    userEmail = val;
    // ì…ë ¥ì°½ ìˆ¨ê¸°ê¸°, ë²„íŠ¼ í‘œì‹œ
    emailInput.style.display = 'none';
    emailSubmit.style.display = 'none';
    emailBtn.textContent = val;
    emailDisplay.style.display = 'block';
  });
  
  // ì´ë©”ì¼ ë²„íŠ¼ ëˆŒëŸ¬ ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜
  emailBtn.addEventListener('click', () => {
    emailDisplay.style.display = 'none';
    emailInput.style.display = 'inline-block';
    emailSubmit.style.display = 'inline-block';
    emailInput.focus();
  });

function addWord(e){
  e.preventDefault();
  
  const uemail = document.getElementById('emailBtn')?.textContent.trim() || "";  
  
  const v = (input.value||"").trim();
  if(!v) return false;
  spawn(v);

  let url = `https://mrdindoin.ddns.net/event/?food=${encodeURIComponent(v)}`;
  
  if (uemail && uemail.includes("@")) {
    url += `&email=${encodeURIComponent(uemail)}`;
  }
  
  fetch(url);
  input.value="";
  input.focus();
  return false;
}

   // --- Close menu on nav-link click + smooth scroll ---
    document.querySelectorAll('#mobileMenu a').forEach((a) => {
      a.addEventListener('click', (e) => {
        const href = a.getAttribute('href');
    
        if (href && href.startsWith('#')) {
          e.preventDefault();
          const target = document.querySelector(href);
          if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }
    
        if (typeof openMenu === 'function') {
          openMenu(false);
        } else {
          const mobileMenu = document.getElementById('mobileMenu');
          const ovl = document.getElementById('overlay');
          const btn = document.getElementById('menuBtn');
          mobileMenu?.classList.remove('show');
          ovl?.classList.remove('show');
          btn?.setAttribute('aria-expanded', 'false');
          document.body.style.overflow = '';
        }
      });
    });
    
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (typeof openMenu === 'function') openMenu(false);
        else {
          document.getElementById('mobileMenu')?.classList.remove('show');
          document.getElementById('overlay')?.classList.remove('show');
          document.getElementById('menuBtn')?.setAttribute('aria-expanded','false');
          document.body.style.overflow = '';
        }
      }
    });

window.addEventListener('resize', () => {
  if (window.innerWidth >= 860) {
    if (typeof openMenu === 'function') openMenu(false);
    else {
      document.getElementById('mobileMenu')?.classList.remove('show');
      document.getElementById('overlay')?.classList.remove('show');
      document.getElementById('menuBtn')?.setAttribute('aria-expanded','false');
      document.body.style.overflow = '';
    }
  }
});

    const NOTICE_URL = "https://mrdindoin.ddns.net/data/notices.json";
    const $feed = document.getElementById('noticeFeed');
    const $skeleton = document.getElementById('noticeSkeleton');
    const $more = document.getElementById('noticeMore');
    const PAGE_SIZE = 6;
    let _notices = [], _page = 0;
    
    function fmtDate(iso){
      try{
        const d = new Date(iso);
        const y = d.getFullYear();
        const m = String(d.getMonth()+1).padStart(2,'0');
        const day = String(d.getDate()).padStart(2,'0');
        return `${y}.${m}.${day}`;
      }catch{ return iso||''; }
    }
    
    function esc(s){ return String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function nl2br(s){ return esc(s).replace(/\n/g, '<br>'); }
    
    function noticeItemHTML(n){
      const hasImg = !!n.image;
      return `
        <article class="card">
          <div class="notice-card">
            ${hasImg ? `<img class="notice-thumb" loading="lazy" src="${esc(n.image)}" alt="">` : `<div class="notice-thumb" aria-hidden="true" style="display:none"></div>`}
            <div>
              <div class="notice-meta">${fmtDate(n.date)}</div>
              <h3 class="notice-title">${esc(n.title)}</h3>
              <div class="notice-body">${nl2br(n.body)}</div>
            </div>
          </div>
        </article>
      `;
    }
    
    function renderPage(){
      const start = _page * PAGE_SIZE;
      const slice = _notices.slice(start, start + PAGE_SIZE);
      if(!slice.length){ $more.style.display = 'none'; return; }
      const html = slice.map(noticeItemHTML).join('');
      $feed.insertAdjacentHTML('beforeend', html);
      _page++;

      $more.style.display = (_page * PAGE_SIZE < _notices.length) ? 'inline-block' : 'none';
    }
    
    async function loadNotices(){
      try{
        $skeleton.style.display = 'grid';
        const res = await fetch(NOTICE_URL, {cache:'no-store', mode:'cors'});
        const data = await res.json();
    
        _notices = (Array.isArray(data) ? data : [])
          .map(n => ({
            title: n.title ?? '',
            body: n.body ?? '',
            date: n.date ?? '',
            image: n.image ?? ''
          }))
          .sort((a,b) => new Date(b.date) - new Date(a.date));
    
        $feed.innerHTML = '';
        _page = 0;
        renderPage();
      }catch(e){
        $feed.innerHTML = `<div class="card"><div class="muted">ê³µì§€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div></div>`;
        console.error('notices load error', e);
      }finally{
        $skeleton.style.display = 'none';
      }
    }
    
    $more.addEventListener('click', renderPage);
    loadNotices();

    // ===== Notice Modal =====
    const modal = document.getElementById('noticeModal');
    const modalImg = document.getElementById('modalImg');
    const modalDate = document.getElementById('modalDate');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalClose = document.querySelector('.modal-close');
    
    function openModal(notice){
      modalImg.src = notice.image || '';
      modalImg.style.display = notice.image ? 'block' : 'none';
      modalDate.textContent = fmtDate(notice.date);
      modalTitle.textContent = notice.title;
      modalBody.innerHTML = nl2br(notice.body);
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
    }
    
    function closeModal(){
      modal.classList.remove('show');
      document.body.style.overflow = '';
    }
    
    modalClose.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{
      if(e.target.classList.contains('modal-backdrop')) closeModal();
    });
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape') closeModal();
    });
    
    function attachNoticeEvents(){
      $feed.querySelectorAll('.card').forEach((card, idx)=>{
        card.addEventListener('click', ()=>{
          const n = _notices[idx];
          if(n) openModal(n);
        });
      });
    }
    
    function renderPage(){
      const start = _page * PAGE_SIZE;
      const slice = _notices.slice(start, start + PAGE_SIZE);
      if(!slice.length){ $more.style.display = 'none'; return; }
      const html = slice.map(noticeItemHTML).join('');
      $feed.insertAdjacentHTML('beforeend', html);
      _page++;
      $more.style.display = (_page * PAGE_SIZE < _notices.length) ? 'inline-block' : 'none';
      attachNoticeEvents(); // << ì¶”ê°€
    }

   fetch('https://mrdindoin.ddns.net/data/top_keywords.json')
    .then(r => r.json())
    .then(d => {
      const box = document.getElementById('keywordList');
      box.innerHTML = d.top_keywords.map(k =>
        `<div><b>${k.rank}ìœ„</b> ${k.keyword} <span style="color:#999;">(${k.count})</span></div>`
      ).join('');
    });

   // ===== Auto Refresh for Notices =====
    const REFRESH_MS = 120000; // 2ë¶„ë§ˆë‹¤ ê°±ì‹  (ì›í•˜ë©´ 300000=5ë¶„)
    let _sig = "";             // ë°ì´í„° ì‹œê·¸ë‹ˆì²˜(ê°„ë‹¨ í•´ì‹œ)
    let _timer = null;
    
    function signatureOf(arr){
      // ìµœì‹  ë‚ ì§œ + ê¸¸ì´ + ì• 3ê°œ ì œëª©ì„ ë¬¶ì–´ ê°„ë‹¨ ì‹œê·¸ë‹ˆì²˜
      if(!Array.isArray(arr) || !arr.length) return "empty";
      const latest = arr
        .map(n => new Date(n.date).getTime() || 0)
        .reduce((a,b)=>Math.max(a,b), 0);
      const titles = arr.slice(0,3).map(n => n.title).join("|");
      return `${arr.length}-${latest}-${titles}`;
    }
    
    function toast(msg="ìƒˆ ê³µì§€ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤"){
      const t = document.getElementById('toast');
      if(!t) return;
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(()=> t.classList.remove('show'), 1800);
    }
    
    async function refreshNotices(){
      try{
        // ìƒˆ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const res = await fetch(NOTICE_URL, {cache:'no-store', mode:'cors'});
        const data = await res.json();
        const next = (Array.isArray(data) ? data : [])
          .map(n => ({ title:n.title??'', body:n.body??'', date:n.date??'', image:n.image??'' }))
          .sort((a,b)=> new Date(b.date) - new Date(a.date));
    
        const nextSig = signatureOf(next);
        if(nextSig !== _sig){
          // ê°±ì‹  ë°œìƒ â†’ ìƒíƒœ êµì²´ & ë¦¬ë Œë”
          _notices = next;
          _sig = nextSig;
          $feed.innerHTML = '';
          _page = 0;
          renderPage();
          toast();
        }
      }catch(e){
        // ì¡°ìš©íˆ ë¬´ì‹œ(ë„¤íŠ¸ì›Œí¬ ì´ìŠˆ ë“±), ì—°ì† ì˜¤ë¥˜ ì‹œ ë°±ì˜¤í”„ ì›í•˜ë©´ ì—¬ê¸°ì„œ ì²˜ë¦¬
        // console.warn('refresh error', e);
      }
    }
    
    function startNoticeAutoRefresh(){
      // ì´ˆê¸° ì‹œê·¸ë‹ˆì²˜ ì„¤ì •
      _sig = signatureOf(_notices);
      stopNoticeAutoRefresh();
      _timer = setInterval(refreshNotices, REFRESH_MS);
    }
    
    function stopNoticeAutoRefresh(){
      if(_timer){ clearInterval(_timer); _timer = null; }
    }
    
    // íƒ­ ë¹„í™œì„±í™” ì‹œ ì •ì§€, ë‹¤ì‹œ í™œì„±í™” ì‹œ ì¦‰ì‹œ ê°±ì‹  + íƒ€ì´ë¨¸ ì¬ê°€ë™
    document.addEventListener('visibilitychange', ()=>{
      if(document.hidden){ stopNoticeAutoRefresh(); }
      else { refreshNotices(); startNoticeAutoRefresh(); }
    });
    
    // ì´ˆê¸° ë¡œë”© ì§í›„ ìë™ ê°±ì‹  ì‹œì‘
    // (loadNotices() ë‚´ë¶€ì—ì„œ renderPage()ê°€ ëë‚œ ë’¤ í˜¸ì¶œ)
    const _origLoadNotices = loadNotices;
    loadNotices = async function(){
      await _origLoadNotices();
      startNoticeAutoRefresh();
    };
    
    // í˜ì´ì§€ ì²« ë¡œë”© ì‹œ loadNoticesê°€ ì´ë¯¸ í˜¸ì¶œë˜ì—ˆë‹¤ë©´,
    // ì•„ë˜ í•œ ì¤„ë¡œë„ ì‹œì‘ ê°€ëŠ¥ (ì¤‘ë³µ ì‹œì‘ ë°©ì§€ ìœ„í•´ ì¡´ì¬ ì²´í¬)
    if(typeof _notices !== 'undefined' && _notices.length >= 0 && !_timer){
      startNoticeAutoRefresh();
    }


   
   

   // --- Back to Top ---
  const toTop = document.getElementById('toTop');
  window.addEventListener('scroll', () => {
    const y = window.scrollY || document.documentElement.scrollTop;
    if (y > 300) toTop.classList.add('show');
    else toTop.classList.remove('show');
  });
  toTop.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

addEventListener('resize', ()=> { cloudWidth = cloud.clientWidth; });
</script>


  
</body>
</html>
