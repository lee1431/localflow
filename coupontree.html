<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>LocalFlow ì¿ í°ë‚˜ë¬´</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ============ LocalFlow Coupon Tree ============ */
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
    }

    .page-wrap {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem 1rem;
    }

    .lf-tree-panel {
      margin: 0 auto;
      max-width: 460px;
      background: linear-gradient(to bottom, #d7f3ff, #fff9db, #fafafa);
      border-radius: 20px;
      padding: 1.5rem 1rem 1.75rem;
      border: 1px solid #e2e8f0;
      text-align: center;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.18);
    }

    .lf-tree-top-text {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 1rem;
      line-height: 1.6;
    }

    .lf-tree-top-text strong {
      color: #e11d48;
    }

    .lf-tree-area {
      position: relative; /* ë§í’ì„ /íŠ¸ë¦¬ ê¸°ì¤€ */
      height: 420px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .lf-tree-hitbox {
      width: 280px;
      height: 380px;
      cursor: pointer;
      position: relative;
    }

    .lf-tree-body {
      width: 100%;
      height: 100%;
      position: relative;
      background: url("./img/ctree.png") center center / contain no-repeat;
      transform-origin: bottom center;
      transition: transform 0.08s ease-out;
      border-radius: 0;
      box-shadow: none;
    }


    /* ì–¼êµ´ ì˜¤ë²„ë ˆì´ */
    .lf-tree-face {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 380px;
      height: 380px;
      border-radius: 999px;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.12);
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .lf-tree-face img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* í”ë“¤ë¦¼ ì• ë‹ˆë©”ì´ì…˜ */
    .lf-tree-body.shake {
      animation: lfTreeShake 0.15s ease-in-out 1;
    }

    .lf-tree-body.shake::after {
      content: "";
      position: absolute;
      inset: 0;
      background: url("./img/ctree.png") center/contain no-repeat;
      opacity: 0.05;
      transform: translateX(5px);
    }

    @keyframes lfTreeShake {
      0%   { transform: rotate(0deg); }
      25%  { transform: rotate(-3deg); }
      50%  { transform: rotate(3deg); }
      75%  { transform: rotate(-2deg); }
      100% { transform: rotate(0deg); }
    }

    /* ë§í’ì„  */
    .lf-tree-dialog {
      position: absolute;
      bottom: -4px;          /* íŠ¸ë¦¬ ì•„ë˜ìª½ ì‚´ì§ ìœ„ */
      left: 50%;
      transform: translate(-50%, 100%);
      padding: 6px 12px;
      background: rgba(0, 0, 0, 0.78);
      color: #fff;
      border-radius: 999px;
      font-size: 0.8rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.6s ease;
      max-width: 90%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .lf-tree-dialog.show {
      opacity: 1;
    }

    .lf-tree-bottom {
      margin-top: 2.5rem;
      font-size: 0.8rem;
      color: #444;
    }

    .lf-tree-stats {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 0.35rem;
    }

    .lf-tree-stats span span {
      font-weight: 600;
      color: #1d4ed8;
    }

    .lf-tree-hint {
      color: #777;
      font-size: 0.75rem;
    }

    @media (max-width: 480px) {
      .lf-tree-panel {
        padding: 1.25rem 0.75rem 1.5rem;
      }
      .lf-tree-area {
        height: 360px;
      }
      .lf-tree-hitbox {
        width: 230px;
        height: 320px;
      }
      .lf-tree-face {
        width: 320px;
        height: 320px;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <section class="lf-tree-panel">

      <div class="lf-tree-top-text">
        ë§ˆìš°ìŠ¤ ë˜ëŠ” ì†ê°€ë½ìœ¼ë¡œ<br />
        <strong>ì¿ í°ë‚˜ë¬´ë¥¼ ë§ˆêµ¬ í„¸ì–´ë³´ì„¸ìš”!</strong>
      </div>

      <div class="lf-tree-area">
        <div class="lf-tree-hitbox" id="lfTreeHitbox" role="button" aria-label="ì¿ í°ë‚˜ë¬´ í”ë“¤ê¸°">
          <div class="lf-tree-body" id="lfTreeBody">
            <div class="lf-tree-face">
              <!-- ì—¬ê¸° ì–¼êµ´ ì‚¬ì§„ ë„£ê¸° -->
              <!-- <img src="./img/face_blur.jpg" alt="ë‚˜ë¬´ ì–¼êµ´" /> -->
            </div>
            <div class="lf-tree-trunk"></div>
          </div>
        </div>

        <!-- ë‚˜ë¬´ ëŒ€ì‚¬ ë§í’ì„  -->
        <div class="lf-tree-dialog" id="lf-treeDialog"></div>
      </div>

      <div class="lf-tree-bottom">
        <div class="lf-tree-stats">
          <span>ì˜¤ëŠ˜ í´ë¦­: <span id="lfClickCount">0</span>íšŒ</span>
          <span>íšë“ ì¿ í°: <span id="lfDropCount">0</span>ê°œ</span>
        </div>
        <div class="lf-tree-hint">
          â€» ë„ˆë¬´ ë¹ ë¥´ê²Œ ì—°íƒ€í•˜ë©´ ë‚˜ë¬´ê°€ í™”ë‚¼ ìˆ˜ ìˆì–´ìš” ğŸ˜ˆ
        </div>
      </div>

    </section>
  </div>

  <script>
    // ====== ì¿ í°ë‚˜ë¬´ í´ë¦­/í„°ì¹˜ ë¡œì§ ======
    const lfTreeHitbox = document.getElementById("lfTreeHitbox");
    const lfTreeBody = document.getElementById("lfTreeBody");
    const lfClickCountEl = document.getElementById("lfClickCount");
    const lfDropCountEl = document.getElementById("lfDropCount");

    let clickCount = 0;
    let dropCount = 0;
    let isCooling = false;

    const lfCouponPool = [
      "BHC ì¹˜í‚¨ 50% í• ì¸ì¿ í°",
      "ì„±ìˆ˜ë†ì› ì²´ë¦¬ 2kg Â· 5,000ì› í• ì¸",
      "ë¡œì»¬ ì¹´í˜ ì•„ë©”ë¦¬ì¹´ë…¸ 1+1",
      "ì¶©ì£¼ì‚¬ë‘ìƒí’ˆê¶Œ 1ë§Œì›ê¶Œ"
    ];

    function lfShake() {
      if (isCooling) return;
      isCooling = true;
      setTimeout(() => (isCooling = false), 120);

      clickCount++;
      lfClickCountEl.textContent = clickCount;

      lfTreeBody.classList.remove("shake");
      void lfTreeBody.offsetWidth; // reflowë¡œ ì• ë‹ˆë©”ì´ì…˜ ì¬ì‹œì‘
      lfTreeBody.classList.add("shake");

      // 2% í™•ë¥ ë¡œ ì¿ í° ë“œë
      if (Math.random() < 0.02) {
        dropCount++;
        lfDropCountEl.textContent = dropCount;
        const prize = lfCouponPool[Math.floor(Math.random() * lfCouponPool.length)];
        alert("ì¿ í° íšë“!\n" + prize);
      }
    }

    lfTreeHitbox.addEventListener("click", lfShake);
    lfTreeHitbox.addEventListener("touchstart", (e) => {
      e.preventDefault();
      lfShake();
    });

    // ====== ë‚˜ë¬´ ìë™ ëŒ€ì‚¬ ë¡œì§ ======
    const treeLineEl = document.getElementById("lf-treeDialog");
    let linesDB = [];

    // ëœë¤ ë¬¸êµ¬ ì„ íƒ
    function pickRandomLine() {
      if (!linesDB || !linesDB.length) return null;
      const idx = Math.floor(Math.random() * linesDB.length);
      return linesDB[idx];
    }

    // ë§í’ì„  ì¶œë ¥ (ë¬´ì¡°ê±´ ì‹¤í–‰ ë²„ì „: í™•ë¥ /ì¿¨íƒ€ì„ ì—†ìŒ)
    function showTreeLine() {
      const line = pickRandomLine();
      if (!line) return;

      treeLineEl.textContent = line;
      treeLineEl.classList.add("show");

      // 3ì´ˆ í›„ í˜ì´ë“œì•„ì›ƒ
      setTimeout(() => {
        treeLineEl.classList.remove("show");
      }, 3000);
    }

    // JSON ë¶ˆëŸ¬ì˜¤ê³ , ë¡œë”© í›„ ì£¼ê¸°ì ìœ¼ë¡œ ëŒ€ì‚¬ ì¶œë ¥
    fetch("https://mrdindoin.ddns.net/data/talktree.json")
      .then(res => res.json())
      .then(data => {
        linesDB = data.lines || [];
        if (!linesDB.length) return;
    
        showTreeLine();
    
        setInterval(showTreeLine, 10000);
      })
      .catch(err => {
        console.error("talktree.json ë¡œë“œ ì˜¤ë¥˜:", err);
      });
  </script>
</body>
</html>
